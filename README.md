## Решение тестового задания

### 1. Провести частичный анализ OVAL [файла](https://www.redhat.com/security/data/oval/v2/RHEL8/rhel-8.oval.xml.bz2) от компании RHEL на первых 3 уязвимостях (патчах). Определить набор объектов, из которых он строится. Понять основную логику "работы" данного формата.

Формат строится из следующих больших смысловых блоков:
- definitions
- tests
- objects
- states

Блок `definitions` также содержит два основных объекта - `metadata` и `criteria`.
Блок `tests` содержит такие объекты как `red-def:rpmverifyfile_test`, `red-def:rpminfo_test`, `red-def:textfilecontent54_test` и, возможно, некоторые другие.
Блок `objects` содержит `red-def:rpmverifyfile_object`, `red-def:rpminfo_object`, `red-def:textfilecontent54_object` и, возможно, некоторые другие.
Блок `states` содержит `red-def:rpmverifyfile_state`, `red-def:rpminfo_state`, `red-def:textfilecontent54_state` и, возможно, некоторые другие.

Логика работы строится следующим образом - в блоке `definitions` хранится  метаинформация об уязвимости (патче), такая как название, описание, ссылки в БД уязвимостей и т.д., а также описание проверок для выявления этой уязвимости (или критерии для установки патча). Все проверки ссылаются на блок `tests`, в котором они записаны в формальном виде. Объекты в `tests` также ссылаются на объекты проверок в `objects` и условия проверки в `states`. При этом сам тег (такой как `rpmverifyfile_test` или `rpminfo_test`) подразумевает под собой запуск определенных команд.

### 2. Описать текстом объекты, которые были найдены и для чего они используются. (Не более 2-3 фраз по каждому объекту).

Как было описано выше - Definitions несет собственно саму информацию об уязвимости, в блоке tests описаны проверки, в разделе objects перечислены объекты проверок, а в части states описана формальное условие теста, применяющееся в объекты.

- `oval_definitions` - Элемент oval_definitions является корнем документа определения OVAL. Его цель — связать вместе основные разделы документа — генератор, определения, тесты, объекты, состояния и переменные, которые являются дочерними элементами корневого элемента.
- `metadata` - Комплексный тип MetadataType содержит все метаданные, доступные для определения OVAL. Эти метаданные предназначены только для информационных целей и не являются частью критериев, используемых для оценки состояния машины.
- `criteria` содержит условия проверок для выявления уязвимостей (необходимости в патче). Элементы из `criteria` ссылаются на объекты из `tests`.
- `tests` - Комплексный тип TestsType - контейнер для одного или нескольких элементов тестирования. Каждый тестовый элемент описывает один OVAL тест.
- Объекты внутри `tests` ссылаются на `states` и `objects`
- `states` - Комплексный тип StatesType представляет собой контейнер для одного или нескольких дочерних элементов состояния. Каждое состояние предоставляет подробную информацию о конкретных характеристиках, которые можно использовать во время оценки объекта.
- `objects` - Комплексный тип ObjectsType представляет собой контейнер для одного или нескольких дочерних элементов объекта. Каждый элемент объекта предоставляет сведения, которые определяют уникальный набор совпадающих элементов, которые будут использоваться тестом OVAL.
- `red-def:rpmverifyfile_test` - используется для проверки целостности отдельных файлов в установленных RPM. Этот тест соответствует команде rpm -V для проверки RPM.
- `red-def:rpminfo_test` - используется для проверки информации заголовка RPM для данного пакета RPM.
- `red-def:textfilecontent54_test` - используется для проверки содержимого текстового файла (он же файла конфигурации) путем просмотра отдельных блоков текста.
- `red-def` указывает на систему, для которой разработаны данные проверки.

Более подробно можно ознакомиться, например, [здесь](https://oval.mitre.org/language/version5.10/).

### 3. В рамках каждого определения уязвимости, есть критерии по ее выявлению: какие из критериев на ваш взгляд лишние?

В определении первых трёх патчей считаю можно отказаться от самой первой проверки на ОС (Red Hat Enterprise Linux must be installed), т.к. дальше в проеверках снова она фигурирует снова с дополнительными условиями.

### 4. Предложить и кратко описать свой вариант по упрощению формата для описания уязвимости вместе с проверками.

Для упрощения формата описания уязвимости вместе с проверками предлагаю следующее:
- Для описания уязвимостей использовать [protobuf](https://protobuf.dev/), т.к. он более производительный и человекочитаемый, по сравнению с XML.
- Отказаться от части метаинформации.
- Отказаться от разделения описания на блоки (definitions, tests, objects, states), т.е. записывать описание и условия проверки в одном блоке, таким образом повысив читаемость правил, но пожертвовав возможностью переиспользовать объекты и проверки.

### 5. После выполненного в предыдущей пунктах анализа, необходимо разработать приложение на языке Python, которое произведет разбор (парсинг) OVAL-файла (достаточно сделать только первые 3 и связанными с ними объекты) и преобразует его в упрощенный формат.

Файл `oval.proto` содержит схему, описывающую преобразование языка `oval` из `xml` в `protobuf`.

Для генерации python кода из файла `oval.proto` не обходимо выполнить команду `.\protobuf\bin\protoc.exe --proto_path=. --python_out=. ./oval.proto`.

Разработанный скрипт (`main.py`) требует нахождения файла `oval_pb2.py` в той же дирректории для возможности его импорта.

Скрипт обладает CLI интерфейсом, который принимает:
- `infile` - Путь до файла `*.oval.xml`
- `outfile` - Путь сохранения бинарного файла (например, `./file.bin`). Необязательный.
- `outstd` - Буелвый флаг. Если указан, то результат работы будет выведен в консоль. Необязательный.
- `limit` - Количество патчей/уязвимостей, в файле, которые нужно обработать. По умолчанию обрабатываются все записи.